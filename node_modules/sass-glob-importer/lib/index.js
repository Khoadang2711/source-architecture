'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _es6Map = require('es6-map');

var _es6Map2 = _interopRequireDefault(_es6Map);

var _isGlob = require('is-glob');

var _isGlob2 = _interopRequireDefault(_isGlob);

var _sortObject = require('sort-object');

var _sortObject2 = _interopRequireDefault(_sortObject);

var _mapFiles = require('map-files');

/**
 * Look for wildcard imports
 * @return {Function}         Function to be used by node-sass importer
 */

var _mapFiles2 = _interopRequireDefault(_mapFiles);

exports['default'] = function () {

  var aliases = new _es6Map2['default']();

  return function (url, parent, done) {

    var base = _path2['default'].join(_path2['default'].dirname(parent), url);

    if (aliases.has(base)) {

      return done(aliases.get(base));
    }

    if ((0, _isGlob2['default'])(base)) {
      var _ret = (function () {

        var files = (0, _sortObject2['default'])((0, _mapFiles2['default'])(base));
        var contents = Object.keys(files).map(function (key) {
          return files[key].content;
        });
        var content = contents.join('\n');

        aliases.set(base, { contents: content });
        return {
          v: done({ contents: content })
        };
      })();

      if (typeof _ret === 'object') return _ret.v;
    }

    aliases.set(base, { file: url });
    done({ file: url });
  };
};

module.exports = exports['default'];